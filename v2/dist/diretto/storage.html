<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns:api="http://www.ioexception.de/rest-api-doc" xmlns="http://www.w3.org/1999/xhtml">
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shCore.css" rel="stylesheet" type="text/css">
<link href="http://alexgorbatchev.com/pub/sh/current/styles/shThemeRDark.css" rel="stylesheet" type="text/css">
<script src="http://alexgorbatchev.com/pub/sh/current/scripts/shCore.js" type="text/javascript"></script><script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushJScript.js" type="text/javascript"></script><script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushXml.js" type="text/javascript"></script><script src="http://alexgorbatchev.com/pub/sh/current/scripts/shBrushPlain.js" type="text/javascript"></script>
<style type="text/css">
			
body {
	background: #FFF;
	color: #333;
	font: normal 100% sans-serif;
margin-left: auto;
	margin-right: auto;

	line-height: 1.5;
	width:66%;
}


.uripart {
	background:#666;
	color: #fff;
	font-style: italic;
}


h1,h2,h3,h4,h5,h6 {
	color: #444;
	font-weight: normal;
	line-height: 1;
	margin-bottom: 0.6em;
	font-family:  Helvetica, sans-serif;

}
h4,h5,h6 {font-weight: bold;}

h1 {font-size: 2.6em;}
h2 {font-size: 2em;margin-top:3em;}
h3 {font-size: 1.5em;margin-top:1.5em;}
h4 {font-size: 1.25em;}
h5 {font-size: 1.1em;}
h6 {font-size: 1em;}

h1 img, h2 img, h3 img, h4 img, h5 img, h6 img {margin: 0;}

pre {
	font: normal 100% monospace; 
}


dl { padding: 0.5em; } dt { background:#fff; float: left; clear: left; padding-left:0.3em; padding-right:0.3em;  text-align: right; }  dd { margin: 0 0 0 110px; padding: 0 0 0.5em 0; }

.statuscode, .method {
	font: bold 100% monospace; 
}

#watermark {
        position:fixed; 
        left:0px; 
        top:0px;
        width:32px;
        height:100%;
        background-color:#EEE;
        padding:0px;
        margin:0px;
} 



#watermark-text {
	color:#999;
	border:0px solid red;
	writing-mode:tb-rl;
	-webkit-transform:rotate(90deg);
	-moz-transform:rotate(90deg);
	-o-transform: rotate(90deg);
	white-space:nowrap;
	display:block;
	bottom:0px;
	width:20px;
	height:20px;
	font-family: Helvetica, sans-serif;
	letter-spacing: 5px;
	font-size:24px;
	font-weight:normal;
	text-shadow: 0px 0px 1px #999;
	padding:0 10px 10px 5px;
}

#watermark-text span{
	padding-left: 30px;
}

#sidemenu {
z-index:300;  display:none;margin: 0;  text-align:left;
}

#sidemenu  li{
	font-size: 0.8em;
}
#sidemenu  li a{
	color: #333;
	font-weight:bold;
}

#sidemenuopener{
z-index:300; color: #333; background-color: #EEEEEE; border:1px solid #DDD; margin: 0;  position: fixed; top: 16px;  left: auto;  width: 56px;  right: 0px; text-align:center;
min-height:32px;
}

#sidemenuopener a{
	color: #333;
	font-weight:bold;
}

a{
	text-decoration: none;
}

#sidemenuopenerbox{
	position: fixed; right:12px;
}

.shadow {
	-moz-box-shadow: 2px 2px 3px #333;
	-webkit-box-shadow: 2px 2px 3px #333;
	box-shadow: 2px 2px 3px #333;
	/* For IE 8 */
	-ms-filter: "progid:DXImageTransform.Microsoft.Shadow(Strength=3, Direction=135, Color='#333333')";
	/* For IE 5.5 - 7 */
	filter: progid:DXImageTransform.Microsoft.Shadow(Strength=3, Direction=135, Color='#333333');
	
}


			</style>
<script type="text/javascript">
					SyntaxHighlighter.all();
			</script><script type="text/javascript">
			function showElement(layer,sx,t1,t2){
			var l = document.getElementById(layer);
			var s = document.getElementById(sx);
			if(l.style.display=="none"){
			l.style.display="block";
			l.backgroundPosition="top";
			s.innerHTML= t2;
			} else {
			l.style.display="none";
			s.innerHTML= t1;
			}
			}
			
			function boxSize(x,a,b){
				var el = document.getElementById(x);
				if(el.style.width === a){
					el.style.width = b;
				}
				else{
					el.style.width = a;
				}
			}
			
			</script>
<title>diretto Storage API - RESTful API Documentation</title>
</head>
<body>
<div id="watermark">
<div id="watermark-text">
<span>diretto Storage API</span><span>v2 - Draft</span>
</div>
</div>
<div id="sidemenuopener" class="shadow">
<div id="sidemenuopenerbox">
<a href="#" class="button" id="menuopener" onclick="javascript:showElement('sidemenu','menuopener','TOC','X'); boxSize('sidemenuopener','25%','56px'); return false;">TOC</a>
</div>
<ol id="sidemenu" style="display:none;">
<li>
<a id="lN65566" href="#" onclick="javascript:showElement('XN65566','lN65566','[+]','[-]'); return false;">
						[+]
					</a> <a href="#N65566">Attachment</a>
<ol id="XN65566" style="display:none;">
<li>
<a href="#N65587">Download an attachment</a>
</li>
<li>
<a href="#N65751">Retrieve attachment's meta data</a>
</li>
<li>
<a href="#N65641">Upload a new attachment</a>
</li>
</ol>
</li>
<li>
<a id="lN65815" href="#" onclick="javascript:showElement('XN65815','lN65815','[+]','[-]'); return false;">
						[+]
					</a> <a href="#N65815">Index</a>
<ol id="XN65815" style="display:none;">
<li>
<a href="#N65825">Get static information</a>
</li>
</ol>
</li>
</ol>
</div>
<h1>diretto Storage API</h1>
<a name="introduction"></a>
<h2>Introduction</h2>
<h4>Version</h4>
<p>v2 - Draft</p>
<h4>Author</h4>
<p>Benjamin Erb</p>
<h4>Description</h4>
<p>The Storage API is responsible for the reception, storage and delivery of submitted attachments of documents. 
The Storage API is designed to support HTTP mechanisms like caching and conditional GETs for improved performance.   
			
	
	</p>
<h4>Authentication Schemes</h4>
<p>
<ul>
<li>Basic Authentication</li>
</ul>
</p>
<h4>Base URI</h4>
<p>
<a xmlns="" href="http://mediaserver/">http://mediaserver/</a>
</p>
<a name="index"></a>
<h2>Index of Resources and Operations</h2>
<ol>
<li xmlns="http://www.w3.org/1999/xhtml">
<a href="#N65566">Attachment</a>
<ol>
<li>
<a href="#N65587">Download an attachment</a>
</li>
<li>
<a href="#N65751">Retrieve attachment's meta data</a>
</li>
<li>
<a href="#N65641">Upload a new attachment</a>
</li>
</ol>
</li>
<li>
<a href="#N65815">Index</a>
<ol>
<li>
<a href="#N65825">Get static information</a>
</li>
</ol>
</li>
</ol>
<a xmlns="" name="N65566"></a>
<h2 class="resource">1. Attachment</h2>
<h4>Description</h4>
<p>An attachment is a media file that belongs to an abstract document. 
Each document owns one or more attachments. The first attachment should be considered as the "original" item, 
while all additional attachments represent derivated or customized versions.
			</p>
<h4>Resource URI</h4>
<pre>http://mediaserver/<span class="uripart">{document-id}</span>/<span class="uripart">{attachment-id}</span>.<span class="uripart">{attachment-ext}</span>
</pre>
<dl>
<dt class="uripart">document-id</dt>
<dd>document ID</dd>
<dt class="uripart">attachment-id</dt>
<dd>attachment ID</dd>
<dt class="uripart">attachment-ext</dt>
<dd>attachment extension</dd>
</dl>
<a name="N65587"></a>
<h3 class="operation">1.1 Download an attachment</h3>
<h4>Description</h4>This operation allows to download an existing attachment. Conditional GETs must be supported by the storage server.
				Clients should support caching and dispatch conditional requests whenever possible.<h4>URI</h4>
<pre>http://mediaserver/{document-id}/{attachment-id}.{attachment-ext}</pre>
<h4>URI Parameters</h4>n/a<h4>HTTP Method</h4>
<span class="method">GET</span>
<h4>Resource Formats</h4>
<ul>
<li>varying</li>
</ul>
<h4>Authentication</h4>not required<h4>Request Entities</h4>n/a<h4>Responses</h4>
<dl>
<dt class="statuscode">200 OK</dt>
<dd>Attachment in response entity</dd>
<dt class="statuscode">304 Not Modified</dt>
<dd>Cache hit (conditional request)</dd>
<dt class="statuscode">403 Forbidden</dt>
<dd>The requested resource URI is not allowed</dd>
<dt class="statuscode">404 Not Found</dt>
<dd>Attachment and/or document not found</dd>
<dt class="statuscode">500 Internal Server Error</dt>
<dd>Internal error while streaming the attachment</dd>
</dl>
<h4>Response Entities</h4>n/a<a name="N65751"></a>
<h3 class="operation">1.2 Retrieve attachment's meta data</h3>
<h4>Description</h4>A HEAD request against an attachment allows to retrieve several meta data.
				Servers must provide the following HTTP headers: <span style="font-family:monospace;">Content-Type</span> (mime type), 
				<span style="font-family:monospace;">Content-Length</span> (file size) and <span style="font-family:monospace;">ETag</span> (caching identifier).  
				This operation should also be used for checking the existence of an attachment.   
				<h4>URI</h4>
<pre>http://mediaserver/{document-id}/{attachment-id}.{attachment-ext}</pre>
<h4>URI Parameters</h4>n/a<h4>HTTP Method</h4>
<span class="method">HEAD</span>
<h4>Resource Formats</h4>
<ul>
<li>n/a</li>
</ul>
<h4>Authentication</h4>not required<h4>Request Entities</h4>n/a<h4>Responses</h4>
<dl>
<dt class="statuscode">200 OK</dt>
<dd>Attachment exists, contents omitted</dd>
<dt class="statuscode">304 Not Modified</dt>
<dd>Cache hit (conditional request)</dd>
<dt class="statuscode">403 Forbidden</dt>
<dd>The requested resource URI is not allowed</dd>
<dt class="statuscode">404 Not Found</dt>
<dd>Attachment and/or document not found</dd>
<dt class="statuscode">500 Internal Server Error</dt>
<dd>Internal error while streaming the attachment</dd>
</dl>
<h4>Response Entities</h4>n/a<a name="N65641"></a>
<h3 class="operation">1.3 Upload a new attachment</h3>
<h4>Description</h4>New attachments must be uploaded to the storage server as part of a three-part workflow.
				First, meta data must be sent to the API server. When the API server grants the creation of a new attachment,
				it also provides an access token that is needed for the actual upload against the storage server.
				Without a valid access token, no upload can be performed. On succcessful upload, the storage server also
				creates a token that must be sent to the API server to approve the upload process.
				This operation does not support chunked uploads and the following request headers are mandatory:  
				<span style="font-family:monospace;">Content-Type</span> (mime type), <span style="font-family:monospace;">Content-Length</span> (file size) and authentication. The actual media file
				must be provided as it is in the request entity. 
				Please note that creating an initial attachment includes creating a document itself. 
				Thus, the first API call slightly differs, because a <span style="font-family:monospace;">PUT</span> against the targeted document location is required instead
				of a <span style="font-family:monospace;">POST</span>. 
				The complete flow is listed here:  
				
				
<pre class="brush: plain">
   Client           API Server        Media Storage

     |                    |                   |
     |                    |                   |
     | (1) POST Metadata  |                   |
     |-------------------&gt;|                   |
     |                    |                   |
     | (2) 202 + Location |                   |
     |&lt;-------------------|                   |
     |                    |                   |
     | (3) PUT Entity (Signed URI)            |
     |--------------------+------------------&gt;|
     |                    |                   |
     | (4) 201 Created + Accept Key in Body   |
     |&lt;-------------------+-------------------|
     |                    |                   |
     | (5) DELETE Lock (via Accept Key)       |
     |-------------------&gt;|                   |
     |                    |                   |
     | (6) 204            |                   |
     |&lt;-------------------|                   |
     |                    |                   |
     |                    |                   |
</pre>				
				
<h4>URI</h4>
<pre>http://mediaserver/{document-id}/{attachment-id}.{attachment-ext}?token=<span class="uripart">{token}</span>
</pre>
<h4>URI Parameters</h4>
<dl>
<dt class="uripart">{token}</dt>
<dd>access token</dd>
</dl>
<h4>HTTP Method</h4>
<span class="method">PUT</span>
<h4>Resource Formats</h4>
<ul>
					
<li>varying</li>
					
<li>application/json</li>
				
</ul>
<h4>Authentication</h4>required<h4>Request Entities</h4>n/a<h4>Responses</h4>
<dl>
<dt class="statuscode">201 Created</dt>
<dd>The attachment has been created</dd>
<dt class="statuscode">400 Bad Request</dt>
<dd>The upload has been rejected (i.e. due to invalid file size)</dd>
<dt class="statuscode">401 Unauthorized</dt>
<dd>Wrong or invalid credentials</dd>
<dt class="statuscode">403 Forbidden</dt>
<dd>The targeted path or the provided access token is invalid</dd>
<dt class="statuscode">409 Conflict</dt>
<dd>The media file already exists</dd>
<dt class="statuscode">411 Length Required</dt>
<dd>Upload failed due to missing Content-Length information</dd>
<dt class="statuscode">500 Internal Server Error</dt>
<dd>Internal server error while handling the upload</dd>
</dl>
<h4>Response Entities</h4>
						
						
<pre class="brush: js">{
	"successToken" : "9365929d8479d2ca39826878984ff5f2b70b5d65"
}</pre>
						In case of a successful upload (201), a response key is provided that must be send to
						the API server in order to prove the upload.
						
						
						<pre class="brush: js">{
	"error" : "The attachment size exceeds the server limits for uploads"
}</pre>
						Otherwise, an error message is available as entity.
												
					<a name="N65815"></a>
<h2 class="resource">2. Index</h2>
<h4>Description</h4>
<p>The index resource provides static information about the deployed service.
			</p>
<h4>Resource URI</h4>
<pre>http://mediaserver/</pre>
<dl></dl>
<a name="N65825"></a>
<h3 class="operation">2.1 Get static information</h3>
<h4>Description</h4>This operation allows to receive static information about the deployment.
				<span style="font-family:monospace;">HEAD</span> requests against this resource may be useful to check the service's availability.<h4>URI</h4>
<pre>http://mediaserver/</pre>
<h4>URI Parameters</h4>n/a<h4>HTTP Method</h4>
<span class="method">GET</span>
<h4>Resource Formats</h4>
<ul>
<li>application/json</li>
</ul>
<h4>Authentication</h4>not required<h4>Request Entities</h4>n/a<h4>Responses</h4>
<dl>
<dt class="statuscode">200 OK</dt>
<dd>Service information in response entity</dd>
</dl>
<h4>Response Entities</h4>
					
					
<pre class="brush: js">{
   "api":{
      "name":"org.diretto.api.storage",
      "version":"v2"
   },
   "service":{
      "name":"diretto Media Node",
      "version":"0.2.0"
   }
}</pre>
					
</body>
</html>
